# Введение

Изначально протокол HTTP был предназначен исключительно для передачи html-страниц. И язык разметки HTML, и протокол его передачи HTTP 
стали одними из основателей эпохи Web 1.0 примерно в 1993 году. Под [Web 1.0](https://ru.wikipedia.org/wiki/Веб_1.0) понимается период жизни WWW, 
когда большая часть ресурсов в интернете была статичной, и пользователи почти не участвовали в генерации контента.

Всё сильно поменялось после бума [доткомов](https://ru.wikipedia.org/wiki/Дотком) в 2001-м году. Бизнес увидел новый рынок на 
Интернет-просторах, возрос пользовательский интерес, и все это привело к технологическому расцвету — появлению множества новых технологий, 
общедоступности широкополосного интернета. Так начался период Web 2.0. Основным отличием этих двух периодов было пользовательское поведение в сети — в период 
Web 2.0 люди начали организовывать сообщества на различных платформах и самостоятельно генерировать контент.

Прогресс не стоит на месте, с тех времен все сильно изменилось: HTTP-сервера, обслуживающие клиентов, далее год от года становятся всё сложнее и 
технически совершеннее. Созданием HTTP-серверов мы и займёмся в этом курсе.

HTTP-сервер — это сервер, отвечающий на запросы по протоколу HTTP (HyperText Transfer Protocol). HTTP — это протокол передачи гипертекста, т.е. 
протокол передачи документов в формате html.

<details>
<summary>Дополнительно про HTTP</summary>
Протокол http - это протокол прикладного (7-го) уровня модели <a href="https://en.wikipedia.org/wiki/OSI_model">OSI</a>.
</details>

Принцип работы протокола HTTP в двух словах:

1. Клиент посылает HTTP-запрос на сервер с определенным URL (Uniform Resource Locator) и [методом](https://developer.mozilla.org/ru/docs/Web/HTTP/Methods).
2. Сервер в зависимости от запроса выдает ответ с соответствующим [кодом](https://www.restapitutorial.com/httpstatuscodes.html).

<details open>
<summary>Например:</summary>

- Если ваш запрос был корректно обработан сервером, вам вернётся ответ с кодом 200 (ОК).
- А если на сервере что-то пошло не так, вам вернётся ответ из 500-го семейства, например, 505.
</details>

Коды ответа нужны для стандартизации взаимодействия между сервером и клиентом.

- `2XX` - Запрос завершился успешно. Например, `201` означает, что новый ресурс был успешно создан.
- `3XX` - Перенаправление на другой адрес, или редирект. `301` говорит о том, что ресурс был навсегда перемещен, а `302` - временно.
- `4XX` - Ошибка на стороне клиента. Стандартный ответ `400` используют, если формат переданных данных некорректен. `403` сигнализирует, что у пользователя нет прав на обращение к ресурсу.
- `5XX` - Ошибка на стороне сервера.

Сегодня протокол HTTP используется не только для передачи html-страниц, но и для:

* межсерверного общения;
* передачи произвольных данных и объектов (json, например) по сети (куда угодно и кому угодно);
* предоставления интерфейса для коммуникации с базами данных (например, clickhouse);

и многого другого...

Умение разрабатывать HTTP-сервера — крайне важный скилл для разработчика.

## Немного про HTTPS

Чтобы избежать кражи паролей или данных кредитных карт, следует использовать протокол HTTPS, который представляет собой защищенную версию протокола HTTP.
Его отличие от HTTP в том, что в нем появляется дополнительный слой шифрования - TLS. Прежде чем отправить запрос, он шифруется, а по прибытии — расшифровывается. 
Таким образом, злоумышленник все еще может читать ваши запросы, но вот понять, что в них содержится, уже не получится. 
 
При установлении HTTPS-соединения TLS выполняет две функции:
* позволяет клиенту убедиться, что это именно тот сервер, с которым он хочет установить соединение
* удостовериться, что ничего нельзя прочитать по пути

### Как устанавливается HTTPS соединение?

В отличие от обычного HTTP соединения, появляется еще один предварительный этап - "рукопожатие" (handshake). В процессе этого этапа клиент и сервер договариваются о способе шифрования и ключе, которым будет зашифрован весь контент.
Хендшейк в свою очередь также состоит из трех этапов:
1. Приветствие
2. Проверка сертификата
3. Обмен ключом шифрования

На этапе приветствия сервер и клиент обмениваются информацией друг о друге. Клиент говорит, что «он умеет», сервер решает, какой алгоритм шифрования и версию TLS использовать с учётом того, что клиент умеет.
Теперь сервер должен подтвердить, что он — это действительно он. Это делается с помощью сертификата.

Сертификат - это просто текстовый файлик, который содержит информацию о владельце, домен, публичный ключ, цифровую подпись и даты валидности сертификата. 
Цифровая подпись - это способ проверить, что сертификат не был подделан по пути. 
Процесс выпуска и проверки сертификатов сложный, и в нем есть куча нюансов. Но если упрощать, то подпись создается с помощью двух ключей (приватного и публичного), приватный хранится у CA (Certificate Authority) и не передается никому, публичный может запрашивать кто угодно. 
Браузер для проверки сертификата идет к CA и просит у него публичный ключ, с помощью которого может расшифровать подпись и убедиться, что сертификат подлинный.  
Есть много различных CA, которые имеют право выписывать сертификаты, а браузеры знают этот список и знают, где брать публичные ключи (или хранят их сразу в билдах, без походов по сети).

Дальше происходит обмен ключами. Ключ шифруется ассиметричным образом, т.е. используя публичный ключ, взятый из сертификата, а сервер расшифровывает его с помощью своего приватного ключа, который надежно хранится на сервере и никому больше не известен. 
Таким образом, перехватить этот запрос-хендшейк и взять ключ оттуда не получится, потому что это не сам ключ, а зашифрованное сообщение. 
И все последующие запросы не получится прочитать, потому что этот самый ключ не известен. Дальше весь HTTP трафик шифруется 
симметричным образом с помощью этого ключа. Симметричный вариант быстрее, поэтому он используется, чтобы шифровать и расшифровывать 
основной массив данных, а ассиметричный вариант используется только один раз для самого синхронного ключа.